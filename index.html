<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Signal Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr/npm/chartjs-adapter-date-fns"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00f260, #0575e6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #8892b0;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        select, button {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        select:hover, button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.primary {
            background: linear-gradient(45deg, #00f260, #0575e6);
            font-weight: bold;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .card h3 {
            color: #8892b0;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .price-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
        }

        .price-change {
            font-size: 1.2em;
            padding: 5px 10px;
            border-radius: 8px;
            display: inline-block;
        }

        .positive { background: rgba(0, 242, 96, 0.2); color: #00f260; }
        .negative { background: rgba(255, 71, 87, 0.2); color: #ff4757; }

        .signal-box {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
            transition: all 0.5s ease;
        }

        .signal-buy {
            background: linear-gradient(135deg, rgba(0, 242, 96, 0.3), rgba(0, 242, 96, 0.1));
            border: 2px solid #00f260;
            box-shadow: 0 0 30px rgba(0, 242, 96, 0.3);
        }

        .signal-sell {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.3), rgba(255, 71, 87, 0.1));
            border: 2px solid #ff4757;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.3);
        }

        .signal-hold {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.3), rgba(255, 193, 7, 0.1));
            border: 2px solid #ffc107;
            box-shadow: 0 0 30px rgba(255, 193, 7, 0.3);
        }

        .signal-text {
            font-size: 2em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .confidence {
            margin-top: 15px;
            font-size: 1.1em;
            color: #ccd6f6;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 400px;
            position: relative;
        }

        .indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .indicator {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid;
        }

        .indicator-bullish { border-left-color: #00f260; }
        .indicator-bearish { border-left-color: #ff4757; }
        .indicator-neutral { border-left-color: #ffc107; }

        .indicator-label {
            font-size: 0.85em;
            color: #8892b0;
            margin-bottom: 5px;
        }

        .indicator-value {
            font-size: 1.3em;
            font-weight: bold;
        }

        .news-feed {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .news-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 3px solid #0575e6;
            transition: all 0.3s ease;
        }

        .news-item:hover {
            background: rgba(0, 0, 0, 0.3);
            transform: translateX(5px);
        }

        .news-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #ccd6f6;
        }

        .news-meta {
            font-size: 0.8em;
            color: #8892b0;
            display: flex;
            justify-content: space-between;
        }

        .sentiment-badge {
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .sentiment-positive { background: rgba(0, 242, 96, 0.3); color: #00f260; }
        .sentiment-negative { background: rgba(255, 71, 87, 0.3); color: #ff4757; }
        .sentiment-neutral { background: rgba(255, 193, 7, 0.3); color: #ffc107; }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #8892b0;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00f260;
            box-shadow: 0 0 10px #00f260;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .analysis-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            color: #a8b2d1;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
        }

        .log-entry::before {
            content: '>';
            position: absolute;
            left: 0;
            color: #00f260;
        }

        .error-message {
            background: rgba(255, 71, 87, 0.2);
            border: 1px solid #ff4757;
            color: #ff4757;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .settings-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .setting-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        input[type="range"] {
            width: 150px;
            accent-color: #00f260;
        }

        .value-display {
            color: #00f260;
            font-weight: bold;
            min-width: 40px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .dashboard { grid-template-columns: 1fr; }
            h1 { font-size: 1.8em; }
            .controls { flex-direction: column; align-items: stretch; }
            select, button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† AI Trading Signal System</h1>
            <p class="subtitle">–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ + –ù–æ–≤–æ—Å—Ç–Ω–æ–π —Ñ–æ–Ω + AI –∞–≥—Ä–µ–≥–∞—Ü–∏—è</p>
        </header>

        <div class="status-bar">
            <div class="api-status">
                <div class="status-dot"></div>
                <span>CoinGecko API: –ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                <span id="api-calls">–ó–∞–ø—Ä–æ—Å–æ–≤: 0</span>
            </div>
            <div id="last-update">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: --</div>
        </div>

        <div class="error-message" id="error-msg"></div>

        <div class="controls">
            <select id="crypto-select">
                <option value="bitcoin">Bitcoin (BTC)</option>
                <option value="ethereum">Ethereum (ETH)</option>
                <option value="binancecoin">BNB</option>
                <option value="solana">Solana (SOL)</option>
                <option value="cardano">Cardano (ADA)</option>
                <option value="ripple">XRP</option>
                <option value="polkadot">Polkadot (DOT)</option>
                <option value="chainlink">Chainlink (LINK)</option>
            </select>
            
            <select id="timeframe">
                <option value="1">1 –¥–µ–Ω—å (–≤–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω–æ–π)</option>
                <option value="7" selected>7 –¥–Ω–µ–π</option>
                <option value="30">30 –¥–Ω–µ–π</option>
                <option value="90">3 –º–µ—Å—è—Ü–∞</option>
            </select>

            <button class="primary" onclick="analyzeMarket()">
                <span id="btn-text">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span>
                <span id="btn-loader" class="loading" style="display:none;"></span>
            </button>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>üí∞ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</h3>
                <div class="price-display" id="current-price">$--</div>
                <div class="price-change" id="price-change">--%</div>
                <div style="margin-top: 10px; color: #8892b0; font-size: 0.9em;">
                    –û–±—ä–µ–º 24—á: <span id="volume">--</span>
                </div>
            </div>

            <div class="card">
                <h3>üìä AI –°–∏–≥–Ω–∞–ª</h3>
                <div class="signal-box signal-hold" id="signal-box">
                    <div class="signal-text" id="signal-text">HOLD</div>
                    <div class="confidence" id="confidence">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 0%</div>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #8892b0;" id="signal-reason">
                        –û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üì∞ –ù–æ–≤–æ—Å—Ç–Ω–æ–π –∞–Ω–∞–ª–∏–∑</h3>
                <div class="news-feed" id="news-feed">
                    <div class="news-item">
                        <div class="news-title">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 0.85em; color: #8892b0;">
                    <span id="sentiment-score">–ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π: –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ</span>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>üìà –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã</h3>
                <div class="indicators" id="indicators">
                    <div class="indicator indicator-neutral">
                        <div class="indicator-label">RSI (14)</div>
                        <div class="indicator-value">--</div>
                    </div>
                    <div class="indicator indicator-neutral">
                        <div class="indicator-label">MACD</div>
                        <div class="indicator-value">--</div>
                    </div>
                    <div class="indicator indicator-neutral">
                        <div class="indicator-label">SMA 20</div>
                        <div class="indicator-value">--</div>
                    </div>
                    <div class="indicator indicator-neutral">
                        <div class="indicator-label">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å</div>
                        <div class="indicator-value">--%</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã AI</h3>
                <div class="settings-panel">
                    <div class="setting-row">
                        <span>–í–µ—Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</span>
                        <div>
                            <input type="range" id="tech-weight" min="0" max="100" value="50" oninput="updateWeight('tech', this.value)">
                            <span class="value-display" id="tech-val">50%</span>
                        </div>
                    </div>
                    <div class="setting-row">
                        <span>–í–µ—Å –Ω–æ–≤–æ—Å—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</span>
                        <div>
                            <input type="range" id="news-weight" min="0" max="100" value="30" oninput="updateWeight('news', this.value)">
                            <span class="value-display" id="news-val">30%</span>
                        </div>
                    </div>
                    <div class="setting-row">
                        <span>–í–µ—Å —Ç—Ä–µ–Ω–¥–∞ —Ä—ã–Ω–∫–∞</span>
                        <div>
                            <input type="range" id="trend-weight" min="0" max="100" value="20" oninput="updateWeight('trend', this.value)">
                            <span class="value-display" id="trend-val">20%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ü§ñ –õ–æ–≥ –∞–Ω–∞–ª–∏–∑–∞ AI</h3>
                <div class="analysis-log" id="analysis-log">
                    <div class="log-entry">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∞–Ω–∞–ª–∏–∑—É...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let chart;
        let apiCalls = 0;
        let weights = { tech: 50, news: 30, trend: 20 };
        let currentData = null;
        let newsData = [];

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_CONFIG = {
            coingecko: 'https://api.coingecko.com/api/v3',
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–≤–µ—Ä—Å–∏—é –±–µ–∑ –∫–ª—é—á–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 10-30 –≤—ã–∑–æ–≤–æ–≤/–º–∏–Ω)
            news: 'https://newsdata.io/api/1/news?apikey=pub_428138d5a7611e5abcb9d1879e3dd3eb&q=crypto&category=business,technology'
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            analyzeMarket();
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            setInterval(analyzeMarket, 300000);
        });

        function updateWeight(type, value) {
            weights[type] = parseInt(value);
            document.getElementById(`${type}-val`).textContent = value + '%';
            
            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ —á—Ç–æ–±—ã —Å—É–º–º–∞ –±—ã–ª–∞ 100%
            const sum = weights.tech + weights.news + weights.trend;
            if (sum > 100) {
                // –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –¥—Ä—É–≥–∏—Ö –≤–µ—Å–æ–≤
                const excess = sum - 100;
                if (type === 'tech') {
                    if (weights.news >= weights.trend) weights.news -= Math.ceil(excess/2);
                    else weights.trend -= Math.ceil(excess/2);
                } else if (type === 'news') {
                    if (weights.tech >= weights.trend) weights.tech -= Math.ceil(excess/2);
                    else weights.trend -= Math.ceil(excess/2);
                } else {
                    if (weights.tech >= weights.news) weights.tech -= Math.ceil(excess/2);
                    else weights.news -= Math.ceil(excess/2);
                }
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('tech-val').textContent = weights.tech + '%';
                document.getElementById('news-val').textContent = weights.news + '%';
                document.getElementById('trend-val').textContent = weights.trend + '%';
                document.getElementById('tech-weight').value = weights.tech;
                document.getElementById('news-weight').value = weights.news;
                document.getElementById('trend-weight').value = weights.trend;
            }
        }

        function log(message) {
            const logEl = document.getElementById('analysis-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.insertBefore(entry, logEl.firstChild);
            if (logEl.children.length > 20) logEl.removeChild(logEl.lastChild);
        }

        function showError(msg) {
            const errEl = document.getElementById('error-msg');
            errEl.textContent = '‚ö†Ô∏è ' + msg;
            errEl.style.display = 'block';
            setTimeout(() => errEl.style.display = 'none', 5000);
        }

        async function analyzeMarket() {
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            
            btnText.style.display = 'none';
            btnLoader.style.display = 'inline-block';

            try {
                const coin = document.getElementById('crypto-select').value;
                const days = document.getElementById('timeframe').value;
                
                log(`–ù–∞—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑–∞ ${coin.toUpperCase()}...`);
                
                // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–∞–Ω–Ω—ã—Ö
                const [marketData, newsData, ohlcvData] = await Promise.all([
                    fetchMarketData(coin),
                    fetchNewsData(coin),
                    fetchOHLCVData(coin, days)
                ]);

                currentData = { marketData, newsData, ohlcvData };
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                updatePriceDisplay(marketData);
                updateChart(ohlcvData, coin);
                
                // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
                const techAnalysis = performTechnicalAnalysis(ohlcvData);
                updateIndicators(techAnalysis);
                
                // AI –ê–Ω–∞–ª–∏–∑
                const aiResult = generateSignal(techAnalysis, newsData, marketData);
                updateSignal(aiResult);
                updateNewsFeed(newsData, aiResult.newsImpact);
                
                document.getElementById('last-update').textContent = 
                    '–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ' + new Date().toLocaleTimeString();
                
                log('–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                
            } catch (error) {
                console.error('Analysis error:', error);
                showError('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
                log('–û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
            }
        }

        async function fetchMarketData(coin) {
            const response = await fetch(
                `${API_CONFIG.coingecko}/coins/${coin}?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false`
            );
            apiCalls++;
            document.getElementById('api-calls').textContent = `–ó–∞–ø—Ä–æ—Å–æ–≤: ${apiCalls}`;
            
            if (!response.ok) throw new Error('CoinGecko API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            return await response.json();
        }

        async function fetchOHLCVData(coin, days) {
            const response = await fetch(
                `${API_CONFIG.coingecko}/coins/${coin}/ohlc?vs_currency=usd&days=${days}`
            );
            apiCalls++;
            document.getElementById('api-calls').textContent = `–ó–∞–ø—Ä–æ—Å–æ–≤: ${apiCalls}`;
            
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è OHLCV –¥–∞–Ω–Ω—ã—Ö');
            return await response.json();
        }

        async function fetchNewsData(coin) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫-–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–µ–π –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–¥–µ–º–æ-—Ä–µ–∂–∏–º)
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ NewsData.io –∏–ª–∏ –∞–Ω–∞–ª–æ–≥—É
            try {
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ NewsData.io
                const response = await fetch(
                    `https://newsdata.io/api/1/news?apikey=demo&q=${coin}&category=business,technology&language=en`
                );
                if (response.ok) {
                    const data = await response.json();
                    return data.results || generateMockNews(coin);
                }
            } catch (e) {
                log('News API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
            }
            return generateMockNews(coin);
        }

        function generateMockNews(coin) {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            const sentiments = ['positive', 'negative', 'neutral'];
            const templates = [
                { title: `${coin.toUpperCase()} –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–æ—Å—Ç –Ω–∞ —Ñ–æ–Ω–µ –æ–±—â–µ–≥–æ –æ–ø—Ç–∏–º–∏–∑–º–∞ —Ä—ã–Ω–∫–∞`, sentiment: 'positive', score: 0.8 },
                { title: `–ö—Ä—É–ø–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏–∏ –≤ ${coin.toUpperCase()}`, sentiment: 'positive', score: 0.7 },
                { title: `–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: ${coin.toUpperCase()} –ø—Ä–æ–±–∏–≤–∞–µ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ`, sentiment: 'positive', score: 0.6 },
                { title: `–†–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ –æ–ø–∞—Å–µ–Ω–∏—è –¥–∞–≤—è—Ç –Ω–∞ ${coin.toUpperCase()}`, sentiment: 'negative', score: -0.6 },
                { title: `–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ${coin.toUpperCase()} –¥–æ—Å—Ç–∏–≥–ª–∞ –º–∞–∫—Å–∏–º—É–º–∞ –º–µ—Å—è—Ü–∞`, sentiment: 'negative', score: -0.4 },
                { title: `–†—ã–Ω–æ–∫ ${coin.toUpperCase()} –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º`, sentiment: 'neutral', score: 0.1 },
                { title: `–ê–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å–ø–æ—Ä—è—Ç –æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞—Ö ${coin.toUpperCase()} –Ω–∞ Q1`, sentiment: 'neutral', score: 0.0 }
            ];
            
            // –í—ã–±–∏—Ä–∞–µ–º 3-5 —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
            const shuffled = templates.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.floor(Math.random() * 3) + 3).map((item, idx) => ({
                title: item.title,
                description: '–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –æ–±–∑–æ—Ä —Ä—ã–Ω–æ—á–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏...',
                pubDate: new Date(Date.now() - idx * 3600000).toISOString(),
                sentiment: item.sentiment,
                sentimentScore: item.score,
                source: 'Market Analysis'
            }));
        }

        function performTechnicalAnalysis(ohlcv) {
            if (!ohlcv || ohlcv.length < 20) return null;

            const closes = ohlcv.map(candle => candle[4]);
            const highs = ohlcv.map(candle => candle[2]);
            const lows = ohlcv.map(candle => candle[3]);
            
            // –†–∞—Å—á–µ—Ç RSI
            const rsi = calculateRSI(closes, 14);
            
            // –†–∞—Å—á–µ—Ç MACD
            const macd = calculateMACD(closes);
            
            // –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ
            const sma20 = calculateSMA(closes, 20);
            const sma50 = closes.length >= 50 ? calculateSMA(closes, 50) : null;
            
            // –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR)
            const atr = calculateATR(highs, lows, closes, 14);
            const volatility = (atr / closes[closes.length - 1]) * 100;
            
            // –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
            const support = Math.min(...lows.slice(-20));
            const resistance = Math.max(...highs.slice(-20));
            
            const currentPrice = closes[closes.length - 1];
            const priceChange24h = ((currentPrice - closes[closes.length - 2]) / closes[closes.length - 2]) * 100;
            
            return {
                rsi: rsi,
                macd: macd,
                sma20: sma20,
                sma50: sma50,
                volatility: volatility,
                support: support,
                resistance: resistance,
                currentPrice: currentPrice,
                priceChange24h: priceChange24h,
                trend: sma50 ? (currentPrice > sma50 ? 'bullish' : 'bearish') : 'neutral',
                rsiSignal: rsi > 70 ? 'overbought' : rsi < 30 ? 'oversold' : 'neutral',
                macdSignal: macd.histogram > 0 ? 'bullish' : 'bearish'
            };
        }

        function calculateRSI(prices, period) {
            if (prices.length < period + 1) return 50;
            
            let gains = 0, losses = 0;
            
            for (let i = 1; i <= period; i++) {
                const change = prices[prices.length - i] - prices[prices.length - i - 1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macdLine = ema12 - ema26;
            // Signal line (EMA 9 of MACD) - —É–ø—Ä–æ—â–µ–Ω–Ω–æ
            return {
                macd: macdLine,
                signal: macdLine * 0.9, // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—è
                histogram: macdLine - (macdLine * 0.9)
            };
        }

        function calculateEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = prices[i] * k + ema * (1 - k);
            }
            return ema;
        }

        function calculateSMA(prices, period) {
            const sum = prices.slice(-period).reduce((a, b) => a + b, 0);
            return sum / period;
        }

        function calculateATR(highs, lows, closes, period) {
            let trSum = 0;
            for (let i = 1; i <= period; i++) {
                const idx = highs.length - i;
                const tr = Math.max(
                    highs[idx] - lows[idx],
                    Math.abs(highs[idx] - closes[idx - 1]),
                    Math.abs(lows[idx] - closes[idx - 1])
                );
                trSum += tr;
            }
            return trSum / period;
        }

        function generateSignal(tech, news, market) {
            if (!tech) return { signal: 'HOLD', confidence: 0, reason: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö' };

            // 1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–∫–æ—Ä (0-100)
            let techScore = 50;
            if (tech.rsi < 30) techScore += 20; // –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å = –ø–æ–∫—É–ø–∫–∞
            else if (tech.rsi > 70) techScore -= 20; // –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å = –ø—Ä–æ–¥–∞–∂–∞
            
            if (tech.macdSignal === 'bullish') techScore += 15;
            else techScore -= 15;
            
            if (tech.trend === 'bullish') techScore += 10;
            else if (tech.trend === 'bearish') techScore -= 10;
            
            // –ë–ª–∏–∑–æ—Å—Ç—å –∫ —É—Ä–æ–≤–Ω—è–º
            const distToSupport = ((tech.currentPrice - tech.support) / tech.support) * 100;
            const distToResistance = ((tech.resistance - tech.currentPrice) / tech.resistance) * 100;
            
            if (distToSupport < 2) techScore += 10; // –ë–ª–∏–∑–∫–æ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
            if (distToResistance < 2) techScore -= 10; // –ë–ª–∏–∑–∫–æ –∫ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—é
            
            techScore = Math.max(0, Math.min(100, techScore));

            // 2. –ù–æ–≤–æ—Å—Ç–Ω–æ–π —Å–∫–æ—Ä (0-100)
            let newsScore = 50;
            let newsImpact = 0;
            if (news && news.length > 0) {
                const avgSentiment = news.reduce((sum, item) => sum + (item.sentimentScore || 0), 0) / news.length;
                newsScore = 50 + (avgSentiment * 50); // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è -1..1 –≤ 0..100
                newsImpact = avgSentiment;
            }

            // 3. –¢—Ä–µ–Ω–¥–æ–≤—ã–π —Å–∫–æ—Ä (0-100)
            let trendScore = 50;
            if (market && market.market_data) {
                const priceChange24h = market.market_data.price_change_percentage_24h || 0;
                const priceChange7d = market.market_data.price_change_percentage_7d || 0;
                
                if (priceChange24h > 5) trendScore += 20;
                else if (priceChange24h < -5) trendScore -= 20;
                
                if (priceChange7d > 10) trendScore += 15;
                else if (priceChange7d < -10) trendScore -= 15;
            }

            // –ò—Ç–æ–≥–æ–≤—ã–π –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Å–∫–æ—Ä
            const finalScore = (
                techScore * (weights.tech / 100) +
                newsScore * (weights.news / 100) +
                trendScore * (weights.trend / 100)
            );

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
            let signal, confidence, reason;
            
            if (finalScore >= 65) {
                signal = 'BUY';
                confidence = Math.min(100, finalScore);
                reason = `–°–∏–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–∏–≥–Ω–∞–ª (${techScore.toFixed(0)}%) + –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π –Ω–æ–≤–æ—Å—Ç–Ω–æ–π —Ñ–æ–Ω`;
                if (tech.rsi < 35) reason += ' | –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å –ø–æ RSI';
                if (tech.macdSignal === 'bullish') reason += ' | MACD –±—ã—á–∏–π –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç';
            } else if (finalScore <= 35) {
                signal = 'SELL';
                confidence = Math.min(100, 100 - finalScore);
                reason = `–°–ª–∞–±—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (${techScore.toFixed(0)}%) + –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ–Ω`;
                if (tech.rsi > 65) reason += ' | –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å –ø–æ RSI';
                if (tech.macdSignal === 'bearish') reason += ' | MACD –º–µ–¥–≤–µ–∂–∏–π –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç';
            } else {
                signal = 'HOLD';
                confidence = 50 - Math.abs(50 - finalScore);
                reason = '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏, –æ–∂–∏–¥–∞–Ω–∏–µ —á–µ—Ç–∫–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è';
                if (tech.volatility > 5) reason += ' | –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å';
            }

            // –õ–æ–≥–∏–∫–∞ AI
            log(`–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑: ${techScore.toFixed(1)}% (RSI: ${tech.rsi.toFixed(1)})`);
            log(`–ù–æ–≤–æ—Å—Ç–Ω–æ–π –∞–Ω–∞–ª–∏–∑: ${newsScore.toFixed(1)}% (Impact: ${newsImpact.toFixed(2)})`);
            log(`–¢—Ä–µ–Ω–¥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑: ${trendScore.toFixed(1)}%`);
            log(`–ò—Ç–æ–≥–æ–≤—ã–π —Å–∫–æ—Ä: ${finalScore.toFixed(1)}% -> ${signal}`);

            return {
                signal,
                confidence,
                reason,
                finalScore,
                techScore,
                newsScore,
                trendScore,
                newsImpact,
                details: tech
            };
        }

        function updatePriceDisplay(data) {
            if (!data || !data.market_data) return;
            
            const price = data.market_data.current_price.usd;
            const change24h = data.market_data.price_change_percentage_24h;
            const volume = data.market_data.total_volume.usd;
            
            document.getElementById('current-price').textContent = '$' + price.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            const changeEl = document.getElementById('price-change');
            changeEl.textContent = (change24h >= 0 ? '+' : '') + change24h.toFixed(2) + '%';
            changeEl.className = 'price-change ' + (change24h >= 0 ? 'positive' : 'negative');
            
            document.getElementById('volume').textContent = '$' + (volume / 1e9).toFixed(2) + 'B';
        }

        function updateSignal(result) {
            const box = document.getElementById('signal-box');
            const text = document.getElementById('signal-text');
            const conf = document.getElementById('confidence');
            const reason = document.getElementById('signal-reason');
            
            // –°–±—Ä–æ—Å –∫–ª–∞—Å—Å–æ–≤
            box.className = 'signal-box';
            
            text.textContent = result.signal;
            conf.textContent = `–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${result.confidence.toFixed(0)}%`;
            reason.textContent = result.reason;
            
            if (result.signal === 'BUY') {
                box.classList.add('signal-buy');
            } else if (result.signal === 'SELL') {
                box.classList.add('signal-sell');
            } else {
                box.classList.add('signal-hold');
            }
        }

        function updateIndicators(tech) {
            if (!tech) return;
            
            const container = document.getElementById('indicators');
            container.innerHTML = `
                <div class="indicator ${tech.rsiSignal === 'oversold' ? 'indicator-bullish' : tech.rsiSignal === 'overbought' ? 'indicator-bearish' : 'indicator-neutral'}">
                    <div class="indicator-label">RSI (14)</div>
                    <div class="indicator-value">${tech.rsi.toFixed(1)}</div>
                    <div style="font-size:0.8em;color:#8892b0">${tech.rsiSignal}</div>
                </div>
                <div class="indicator ${tech.macdSignal === 'bullish' ? 'indicator-bullish' : 'indicator-bearish'}">
                    <div class="indicator-label">MACD</div>
                    <div class="indicator-value">${tech.macd.histogram > 0 ? 'Bullish' : 'Bearish'}</div>
                    <div style="font-size:0.8em;color:#8892b0">${tech.macd.histogram.toFixed(4)}</div>
                </div>
                <div class="indicator ${tech.currentPrice > tech.sma20 ? 'indicator-bullish' : 'indicator-bearish'}">
                    <div class="indicator-label">SMA 20</div>
                    <div class="indicator-value">$${tech.sma20.toFixed(2)}</div>
                    <div style="font-size:0.8em;color:#8892b0">Price: ${tech.currentPrice > tech.sma20 ? 'Above' : 'Below'}</div>
                </div>
                <div class="indicator ${tech.volatility > 5 ? 'indicator-bearish' : 'indicator-neutral'}">
                    <div class="indicator-label">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å</div>
                    <div class="indicator-value">${tech.volatility.toFixed(2)}%</div>
                    <div style="font-size:0.8em;color:#8892b0">ATR based</div>
                </div>
            `;
        }

        function updateNewsFeed(news, impact) {
            const container = document.getElementById('news-feed');
            container.innerHTML = '';
            
            if (!news || news.length === 0) {
                container.innerHTML = '<div class="news-item"><div class="news-title">–ù–æ–≤–æ—Å—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</div></div>';
                return;
            }
            
            news.forEach(item => {
                const div = document.createElement('div');
                div.className = 'news-item';
                
                const sentimentClass = item.sentiment === 'positive' ? 'sentiment-positive' : 
                                     item.sentiment === 'negative' ? 'sentiment-negative' : 'sentiment-neutral';
                const sentimentText = item.sentiment === 'positive' ? 'Bullish' : 
                                    item.sentiment === 'negative' ? 'Bearish' : 'Neutral';
                
                div.innerHTML = `
                    <div class="news-title">${item.title}</div>
                    <div class="news-meta">
                        <span>${item.source || 'Crypto News'} ‚Ä¢ ${new Date(item.pubDate).toLocaleTimeString()}</span>
                        <span class="sentiment-badge ${sentimentClass}">${sentimentText}</span>
                    </div>
                `;
                container.appendChild(div);
            });
            
            const sentimentText = impact > 0.2 ? '–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π üü¢' : impact < -0.2 ? '–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π üî¥' : '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π üü°';
            document.getElementById('sentiment-score').textContent = `–ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π: ${sentimentText} (${(impact * 100).toFixed(0)}%)`;
        }

        function updateChart(ohlcv, coin) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            const labels = ohlcv.map(c => new Date(c[0]));
            const prices = ohlcv.map(c => c[4]);
            
            // –†–∞—Å—á–µ—Ç SMA –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const sma20 = [];
            for (let i = 19; i < prices.length; i++) {
                const avg = prices.slice(i-19, i+1).reduce((a,b) => a+b, 0) / 20;
                sma20.push(avg);
            }
            
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(0, 242, 96, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 242, 96, 0.0)');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–¶–µ–Ω–∞ (USD)',
                        data: prices,
                        borderColor: '#00f260',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }, {
                        label: 'SMA 20',
                        data: Array(19).fill(null).concat(sma20),
                        borderColor: '#0575e6',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#ccd6f6' }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#ccd6f6',
                            borderColor: '#00f260',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM d'
                                }
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#8892b0'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#8892b0',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
        window.addEventListener('error', (e) => {
            if (e.message.includes('fetch')) {
                showError('–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç–µ–≤—ã–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.');
            }
        });
    </script>
</body>
</html>

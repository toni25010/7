<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Si AI Terminal | –ù–æ–≤–æ—Å—Ç–∏ –†–æ—Å—Å–∏–∏</title>
    <script src="https://unpkg.com/lightweight-charts@4.0.1/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --accent: #8957e5; --buy: #238636; --sell: #f85149; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); padding: 12px; min-height: 100vh; }
        h2 { text-align: center; font-size: clamp(1.1rem, 4vw, 1.6rem); margin: 0 0 12px 0; }
        .grid { display: grid; grid-template-columns: 2.2fr 1fr; gap: 16px; max-width: 1600px; margin: 0 auto; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        
        #chart { height: 400px; width: 100%; position: relative; background: var(--card); border-radius: 12px; overflow: hidden; }
        
        .ticker-wrap { display: flex; justify-content: space-between; background: #0d1117; padding: 12px; border-radius: 12px; margin-bottom: 12px; border: 1px solid var(--border); }
        .ticker-val { font-size: 24px; font-weight: 700; font-family: 'Courier New'; }
        .ticker-label { font-size: 10px; color: #8b949e; margin-bottom: 2px; }
        
        .signal-display { text-align: center; padding: 12px; border-radius: 16px; border: 2px solid var(--border); margin-bottom: 12px; transition: 0.3s; }
        .signal-display.buy { border-color: var(--buy); color: #3fb950; background: rgba(35, 134, 54, 0.1); }
        .signal-display.sell { border-color: var(--sell); color: var(--sell); background: rgba(248, 81, 73, 0.1); }
        .signal-display.hold { border-color: #d29922; color: #d29922; background: rgba(210, 153, 34, 0.1); }
        
        .trade-plan-box { margin-top: 10px; background: #0d1117; border-radius: 12px; padding: 10px; border: 1px solid var(--border); display: none; }
        .plan-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
        .plan-row:last-child { border-bottom: none; }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        
        .news-box { margin-top: 12px; max-height: 300px; overflow-y: auto; font-size: 12px; }
        .news-item { padding: 8px; border-left: 2px solid #3b82f6; margin-bottom: 6px; background: rgba(255,255,255,0.02); position: relative; }
        .news-item.high { border-left-color: #f85149; }
        .news-item.medium { border-left-color: #d29922; }
        .news-item.low { border-left-color: #3b82f6; }
        .news-time { color: #60a5fa; font-size: 10px; font-weight: 600; margin-bottom: 2px; display: block; }
        .news-text { color: var(--text); }
        .news-sentiment { display: inline-block; padding: 2px 6px; border-radius: 10px; font-size: 9px; font-weight: 600; margin-top: 4px; }
        .sentiment-bullish { background: rgba(35, 134, 54, 0.2); color: #3fb950; }
        .sentiment-bearish { background: rgba(248, 81, 73, 0.2); color: #f85149; }
        .sentiment-neutral { background: rgba(210, 153, 34, 0.2); color: #d29922; }
        .news-filter { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
        .filter-btn { background: #21262d; color: var(--text); border: 1px solid var(--border); padding: 4px 8px; border-radius: 12px; font-size: 10px; cursor: pointer; transition: 0.2s; }
        .filter-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        .filter-btn:hover { opacity: 0.8; }
        .news-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .news-header span { color: #8b949e; font-size: 11px; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 10px; }
        .stat-item { background: #0d1117; padding: 8px; border-radius: 6px; font-size: 12px; border: 1px solid var(--border); }
        
        button { background: var(--accent); color: white; border: none; padding: 12px 16px; cursor: pointer; border-radius: 12px; width: 100%; font-weight: 600; margin-top: 10px; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        button.small { background: #21262d; width: auto; padding: 8px 12px; margin-top: 0; font-size: 12px; }
        
        input { width: 100%; padding: 10px; background: #0d1117; color: white; border: 1px solid var(--border); border-radius: 10px; margin-top: 6px; font-size: 14px; }
        
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); padding: 10px 20px; border-radius: 30px; border: 1px solid var(--border); z-index: 100; font-size: 12px; display: flex; align-items: center; gap: 8px; }
        .spinner { width: 12px; height: 12px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-msg { color: var(--sell); font-size: 12px; text-align: center; margin-top: 10px; }

        @media (max-width: 1100px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <h2>Si AI Terminal | –ù–æ–≤–æ—Å—Ç–∏ –†–æ—Å—Å–∏–∏</h2>

    <div class="grid">
        <!-- LEFT -->
        <div class="card">
            <div id="chart"><div id="loading"><div class="spinner"></div> –ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 6px; padding: 0 4px; font-size: 11px; color: #8b949e;">
                <span id="contractName">–ö–æ–Ω—Ç—Ä–∞–∫—Ç: --</span>
                <span id="lastTradeTime">--</span>
            </div>

            <!-- –ù–û–í–û–°–¢–ù–û–ô –ë–õ–û–ö (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π) -->
            <div class="news-box" id="newsBox">
                <div class="news-header">
                    <span style="font-weight: 600; color: #3b82f6;">–ù–æ–≤–æ—Å—Ç–∏ (–ò–Ω–≤–µ—Å—Ç–∏–Ω–≥, –õ–µ–Ω—Ç–∞, –í–µ–¥–æ–º–æ—Å—Ç–∏)</span>
                    <span id="newsCount">0</span>
                </div>
                <div class="news-filter">
                    <button class="filter-btn active" onclick="filterNews('all', event)">–í—Å–µ</button>
                    <button class="filter-btn" onclick="filterNews('bullish', event)">–ë—ã—á—å–∏ –¥–ª—è Si</button>
                    <button class="filter-btn" onclick="filterNews('bearish', event)">–ú–µ–¥–≤–µ–∂—å–∏ –¥–ª—è Si</button>
                    <button class="filter-btn" onclick="refreshNews()">üîÑ</button>
                </div>
                <div id="newsList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="card">
            <div class="ticker-wrap">
                <div style="text-align: left;">
                    <div class="ticker-label">–ü–û–°–õ–ï–î–ù–Ø–Ø –¶–ï–ù–ê</div>
                    <div class="ticker-val" id="currentPrice">--</div>
                </div>
                <div style="text-align: right;">
                    <div class="ticker-label">–ò–ó–ú–ï–ù–ï–ù–ò–ï</div>
                    <div class="ticker-val" id="changePercent">--</div>
                </div>
            </div>

            <div id="signal_ui" class="signal-display hold">
                <div style="font-size: 10px; opacity: 0.7;">–°–ò–ì–ù–ê–õ</div>
                <div id="signal_text" style="font-size: 24px; font-weight: bold;">–û–ñ–ò–î–ê–ù–ò–ï</div>
                <div id="signal_confidence" style="font-size: 11px; margin-top: 2px;"></div>
            </div>

            <div id="tradePlanBox" class="trade-plan-box">
                <div style="text-align: center; font-size: 11px; font-weight: 600; color: var(--accent); margin-bottom: 6px;">–¢–û–†–ì–û–í–´–ô –ü–õ–ê–ù</div>
                <div class="plan-row"><span><span class="dot" style="background: #58a6ff;"></span>Entry</span><span id="aiEntry" style="color: #58a6ff">--</span></div>
                <div class="plan-row"><span><span class="dot" style="background: var(--buy);"></span>TP</span><span id="aiTP" style="color: var(--buy)">--</span></div>
                <div class="plan-row"><span><span class="dot" style="background: var(--sell);"></span>SL</span><span id="aiSL" style="color: var(--sell)">--</span></div>
            </div>

            <div id="ai_desc" class="error-msg" style="display:none;"></div>

            <div class="stats-grid" id="statsGrid" style="display: none;">
                <div class="stat-item"><div style="color: #8b949e; font-size: 10px;">RSI</div><div id="statRsi" style="font-weight: 600;">-</div></div>
                <div class="stat-item"><div style="color: #8b949e; font-size: 10px;">ATR</div><div id="statAtr" style="font-weight: 600;">-</div></div>
                <div class="stat-item"><div style="color: #8b949e; font-size: 10px;">MACD</div><div id="statMacd" style="font-weight: 600;">-</div></div>
                <div class="stat-item"><div style="color: #8b949e; font-size: 10px;">–¢—Ä–µ–Ω–¥</div><div id="statTrend" style="font-weight: 600;">-</div></div>
            </div>

            <button onclick="runAnalysis()" type="button"> –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó</button>

            <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border);">
                <label style="font-size: 11px;">API Key:</label>
                <input type="password" id="api_key_input" placeholder="sk-or-..." value="">
                <button class="small" onclick="saveKey()" style="margin-top: 4px; width: 100%;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==================
        const MOEX_BASE = "https://iss.moex.com/iss/engines/futures/markets/forts";
        
        let currentTicker = null;
        let chart = null;
        let candleSeries = null;
        let priceLines = [];
        let historyData = [];
        let allNews = [];            // –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ (–¥–ª—è AI –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
        let currentNewsFilter = 'all'; // —Ç–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä
        const currentTf = 60;         // —Ç–æ–ª—å–∫–æ 1H

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (–¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
        let analysisState = {
            news: { score: 0, direction: 'neutral', items: [] }
        };

        // ==================== 1. SMART TICKER ====================
        const antiCache = () => `_=${Date.now()}`;

        async function detectActiveContract() {
            const loading = document.getElementById('loading');
            loading.style.display = 'flex';
            loading.innerHTML = '<div class="spinner"></div> –ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–∞...';
            
            const url = `${MOEX_BASE}/securities.json?q=Si&iss.only=marketdata,securities&${antiCache()}`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                const cols = data.marketdata.columns;
                const rows = data.marketdata.data;
                
                let best = { ticker: 'SiH6', vol: 0 };
                const idxVol = cols.indexOf('VALTODAY');
                const secCols = data.securities.columns;
                const secRows = data.securities.data;
                const idxSecId = secCols.indexOf('SECID');

                rows.forEach((row, i) => {
                    const secId = secRows[i] ? secRows[i][idxSecId] : '';
                    if (!secId.startsWith('Si')) return;
                    const vol = row[idxVol] || 0;
                    if (vol > best.vol) best = { ticker: secId, vol: vol };
                });

                currentTicker = best.ticker;
                document.getElementById('contractName').innerText = `–ö–æ–Ω—Ç—Ä–∞–∫—Ç: ${currentTicker}`;
                return true;
            } catch(e) {
                currentTicker = "SiH6";
                return false;
            }
        }

        // ==================== 2. –î–ê–ù–ù–´–ï MOEX ==================
        async function fetchQuotes() {
            if(!currentTicker) return;
            const url = `${MOEX_BASE}/securities/${currentTicker}.json?iss.only=marketdata&${antiCache()}`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                const cols = data.marketdata.columns;
                const row = data.marketdata.data[0];
                if(!row) return;
                
                const idx = { last: cols.indexOf('LAST'), chg: cols.indexOf('CHANGE'), time: cols.indexOf('SYSTIME'), prev: cols.indexOf('PREVPRICE') };
                
                const quote = {
                    price: row[idx.last],
                    change: row[idx.chg],
                    prev: row[idx.prev],
                    time: row[idx.time]
                };
                
                updatePriceUI(quote);
                if(quote.price) updateChartLive(quote.price);

            } catch(e) { console.error("Quote error", e); }
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ MOEX (MSK) –≤ UTC timestamp
        function parseMoexTime(dateStr) {
            const [datePart, timePart] = dateStr.split(' ');
            const [year, month, day] = datePart.split('-').map(Number);
            const [hour, minute, second] = timePart.split(':').map(Number);
            return Math.floor(Date.UTC(year, month-1, day, hour-3, minute, second) / 1000);
        }

async function fetchCandles() {
    if(!currentTicker) return;
    console.log('Fetching candles at', new Date().toLocaleTimeString());
    const loading = document.getElementById('loading');
    if (loading) loading.style.display = 'flex';
    
    const d = new Date();
    d.setDate(d.getDate() - 7);
    const from = d.toISOString().split('T')[0];
    
    const url = `${MOEX_BASE}/securities/${currentTicker}/candles.json?interval=${currentTf}&from=${from}&${antiCache()}`;
    
    try {
        const res = await fetch(url);
        const data = await res.json();
        if (!data.candles?.data?.length) throw new Error("–ù–µ—Ç —Å–≤–µ—á–µ–π");

        const cols = data.candles.columns;
        const idx = { o: cols.indexOf('open'), c: cols.indexOf('close'), h: cols.indexOf('high'), l: cols.indexOf('low'), t: cols.indexOf('begin') };

        historyData = data.candles.data.map(r => ({
            time: parseMoexTime(r[idx.t]),
            open: r[idx.o], high: r[idx.h], low: r[idx.l], close: r[idx.c]
        })).filter(c => c.close > 0);

        renderChart(historyData);
    } catch(e) {
        console.error('Error fetching candles:', e);
        const loading = document.getElementById('loading');
        if (loading) loading.innerHTML = `<span style='color:var(--sell); font-size:12px;'>–û—à–∏–±–∫–∞: ${e.message}</span>`;
    } finally {
        const loading = document.getElementById('loading');
        if (loading) loading.style.display = 'none';
    }
}

        // ==================== 3. –ù–û–í–û–°–¢–ò (–ù–û–í–´–ô –ë–õ–û–ö) ==================
        // RSS —Ñ–∏–¥—ã
        const RSS_FEEDS = [
            'https://ru.investing.com/rss/news_25.rss',
            'https://lenta.ru/rss/news',
            'https://www.vedomosti.ru/rss/articles'
        ];

        // –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π (–¥–ª—è Si - —Ä—É–±–ª—å/–¥–æ–ª–ª–∞—Ä)
const KEYWORDS = {
    // üìà –ë—ã—á—å–∏ –¥–ª—è Si (—Ä—É–±–ª—å —Å–ª–∞–±–µ–µ—Ç ‚Üí Si —Ä–∞—Å—Ç—ë—Ç)
    bullish: [
        // –í–æ–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ —ç—Å–∫–∞–ª–∞—Ü–∏—è (–†–æ—Å—Å–∏—è –∏ –º–∏—Ä)
        '–∞—Ç–∞–∫–∞', '–≤—Å—É', '–æ–±—Å—Ç—Ä–µ–ª', '–≤–æ–µ–Ω–Ω—ã–µ', '–¥–µ–π—Å—Ç–≤–∏—è', '–∫–æ–Ω—Ñ–ª–∏–∫—Ç',
        '–±–µ—Å–ø–æ—Ä—è–¥–∫–∏', '–Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ', '–ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–µ', '–∂–µ—Ä—Ç–≤—ã', '–≤–æ–π—Å–∫–∞',
        '–≤—Ç–æ—Ä–∂–µ–Ω–∏–µ', '–±–æ–π', '–±–æ–º–±–∞—Ä–¥–∏—Ä–æ–≤–∫–∞', '–±–µ–∂–µ–Ω—Ü—ã', '–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è',
        '—É–≥—Ä–æ–∑–∞', '–Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç—å', '–ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è', '–∏–Ω—Ü–∏–¥–µ–Ω—Ç', '—á–ø',
        '–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞', '—Ç–µ—Ä–∞–∫—Ç', '–≤–∑—Ä—ã–≤', '–ø–æ–∂–∞—Ä', '–∫—Ä—É—à–µ–Ω–∏–µ',
        '–¥–æ–Ω–±–∞—Å—Å', '–∫—Ä—ã–º', '–∫–∏–µ–≤', '—É–∫—Ä–∞–∏–Ω–∞', '–∑–µ–ª–µ–Ω—Å–∫–∏–π',
        '–∏–∑—Ä–∞–∏–ª—å', '–ø–∞–ª–µ—Å—Ç–∏–Ω–∞', '–≥–∞–∑–∞', '–∏—Ä–∞–Ω', '–∏–∑—Ä–∞–∏–ª—å—Å–∫–æ-–ø–∞–ª–µ—Å—Ç–∏–Ω—Å–∫–∏–π',
        '—Ç–∞–π–≤–∞–Ω—å', '–∫–∏—Ç–∞–π', '—Å–µ–≤–µ—Ä–Ω–∞—è –∫–æ—Ä–µ—è', '—Ä–∞–∫–µ—Ç–Ω—ã–π –ø—É—Å–∫',
        '–≤–æ–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è', '–∫–æ–Ω—Ç—Ä–Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ', '–æ–±–æ—Ä–æ–Ω–∞', '—Ñ—Ä–æ–Ω—Ç',
        '–ø–æ—Ç–µ—Ä–∏', '—É–±–∏—Ç—ã–µ', '—Ä–∞–Ω–µ–Ω—ã–µ', '–ø–ª–µ–Ω–Ω—ã–µ', '–≥–æ—Å–ø–∏—Ç–∞–ª—å',
        '–≤–æ–µ–Ω–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ', '–∫–æ–º–µ–Ω–¥–∞–Ω—Ç—Å–∫–∏–π —á–∞—Å', '—ç–≤–∞–∫—É–∞—Ü–∏—è',

        // –°–∞–Ω–∫—Ü–∏–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–ª—é–±—ã–µ —Å—Ç—Ä–∞–Ω—ã –ø—Ä–æ—Ç–∏–≤ –†–æ—Å—Å–∏–∏)
        '—Å–∞–Ω–∫—Ü–∏–∏', '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è', '–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞', '–∑–∞–ø—Ä–µ—Ç', '—ç–º–±–∞—Ä–≥–æ',
        '–±–æ–π–∫–æ—Ç', '–∏–∑–æ–ª—è—Ü–∏—è', '–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ', 'swift', '–∑–∞–º–æ—Ä–æ–∑–∫–∞',
        '–∞–∫—Ç–∏–≤—ã', '–∞—Ä–µ—Å—Ç', '–∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è', '—Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫',
        '—á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫', '—ç–∫—Å–ø–æ—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å', '–≤–∏–∑–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è',
        '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞', '–ø–æ—à–ª–∏–Ω—ã', '—Ç–∞—Ä–∏—Ñ—ã', '—Ç–æ—Ä–≥–æ–≤–∞—è –≤–æ–π–Ω–∞',
        '—Å–∞–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ —Ä–æ—Å—Å–∏–∏', '–∫–æ–Ω–≥—Ä–µ—Å—Å', '–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ', '–∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç',
        '–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã', '–ø—Ä–æ—Ç–∏–≤ —Ä—Ñ', '–∞–Ω—Ç–∏—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ —Å–∞–Ω–∫—Ü–∏–∏',
        '–Ω–æ–≤—ã–µ —Å–∞–Ω–∫—Ü–∏–∏', '—É—Å–∏–ª–µ–Ω–∏–µ —Å–∞–Ω–∫—Ü–∏–π', '—Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ',
        '–∫–æ–Ω–≥—Ä–µ—Å—Å —Å—à–∞', '–ø–∞–ª–∞—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π', '—Å–µ–Ω–∞—Ç', '–±–µ–ª—ã–π –¥–æ–º',
        '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –±–∞–π–¥–µ–Ω–∞', '–¥–æ–Ω–∞–ª—å–¥ —Ç—Ä–∞–º–ø', '—Ä–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Ü—ã', '–¥–µ–º–æ–∫—Ä–∞—Ç—ã',

        // –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–†–æ—Å—Å–∏—è –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ)
        '–∏–Ω—Ñ–ª—è—Ü–∏—è', '–∫—Ä–∏–∑–∏—Å', '–¥–µ—Ñ–∏—Ü–∏—Ç', '—Ä–µ—Ü–µ—Å—Å–∏—è', '–¥–µ–≤–∞–ª—å–≤–∞—Ü–∏—è',
        '–æ–±–≤–∞–ª', '–ø–∞–¥–µ–Ω–∏–µ', '—Å–Ω–∏–∂–µ–Ω–∏–µ', '—É—Ö—É–¥—à–µ–Ω–∏–µ', '–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å',
        '–æ—Ç—Ç–æ–∫ –∫–∞–ø–∏—Ç–∞–ª–∞', '–±–µ–≥—Å—Ç–≤–æ', '–¥–µ—Ñ–æ–ª—Ç', '—Ä–∏—Å–∫', '—Å—Ç–∞–≥–Ω–∞—Ü–∏—è',
        '–±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞', '–±–µ–¥–Ω–æ—Å—Ç—å', '–Ω–∏—â–µ—Ç–∞', '–æ–±–Ω–∏—â–∞–Ω–∏–µ', '—Å—Ç–∞–≥—Ñ–ª—è—Ü–∏—è',
        '–≥–∏–ø–µ—Ä–∏–Ω—Ñ–ª—è—Ü–∏—è', '—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Å–ø–∞–¥', '–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–∞–¥',
        '–ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', '—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –≤–≤–ø', '–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç',
        '–±—é–¥–∂–µ—Ç–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç', '–≥–æ—Å–¥–æ–ª–≥', '–≤–Ω–µ—à–Ω–∏–π –¥–æ–ª–≥', '–¥–æ–ª–≥–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞',
        '–∫—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥', '–ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞', '–º—É—Å–æ—Ä–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥',
        '–¥–µ–≤–∞–ª—å–≤–∞—Ü–∏—è —Ä—É–±–ª—è', '–æ—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ä—É–±–ª—è', '—Ä—É–±–ª—å –¥–µ—à–µ–≤–µ–µ—Ç',

        // –ù–µ—Ñ—Ç—å –∏ —Å—ã—Ä—å—ë (–ø–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω)
        '–Ω–µ—Ñ—Ç—å –ø–∞–¥–∞–µ—Ç', '—Å–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å', '–æ–±–≤–∞–ª –Ω–µ—Ñ—Ç–∏',
        'brent —É–ø–∞–ª', '–Ω–µ—Ñ—Ç—å –¥–µ—à–µ–≤–µ–µ—Ç', '–º–∞—Ä–∫–∞ urals', '—Å—ã—Ä—å—ë –¥–µ—à–µ–≤–µ–µ—Ç',
        '–Ω–µ—Ñ—Ç—å –ø–æ–¥–µ—à–µ–≤–µ–ª–∞', '—Ü–µ–Ω–∞ –Ω–∞ –Ω–µ—Ñ—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è', '–º–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥ –ø–æ –Ω–µ—Ñ—Ç–∏',
        '–ø–µ—Ä–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –Ω–µ—Ñ—Ç–∏', '–∑–∞–ø–∞—Å—ã –Ω–µ—Ñ—Ç–∏ —Ä–∞—Å—Ç—É—Ç', '—Å–ª–∞–Ω—Ü–µ–≤–∞—è –Ω–µ—Ñ—Ç—å',
        '–æ–ø–µ–∫+', '—Å–¥–µ–ª–∫–∞ –æ–ø–µ–∫', '–∫–≤–æ—Ç—ã –æ–ø–µ–∫', '–¥–µ–º–ø–∏–Ω–≥', '—Ü–µ–Ω–æ–≤–∞—è –≤–æ–π–Ω–∞',
        '–≥–∞–∑ –¥–µ—à–µ–≤–µ–µ—Ç', '—É–≥–æ–ª—å –¥–µ—à–µ–≤–µ–µ—Ç', '–º–µ—Ç–∞–ª–ª—ã –¥–µ—à–µ–≤–µ—é—Ç',

        // –î–æ–ª–ª–∞—Ä –∏ –≤–∞–ª—é—Ç–∞ (—Ä–æ—Å—Ç –¥–æ–ª–ª–∞—Ä–∞)
        '–¥–æ–ª–ª–∞—Ä —Ä–∞—Å—Ç—ë—Ç', '–¥–æ–ª–ª–∞—Ä –¥–æ—Ä–æ–∂–∞–µ—Ç', 'usd –≤—ã—Ä–æ—Å', '–∏–Ω–¥–µ–∫—Å –¥–æ–ª–ª–∞—Ä–∞',
        'dxy', 'dollar index', '–µ–≤—Ä–æ –¥–µ—à–µ–≤–µ–µ—Ç', '—Ä—É–±–ª—å —Å–ª–∞–±–µ–µ—Ç',
        '—Ä—É–±–ª—å –ø–∞–¥–∞–µ—Ç', '–æ—Å–ª–∞–±–ª–µ–Ω–∏–µ —Ä—É–±–ª—è', '–Ω–∏–∂–µ 100', '–Ω–∏–∂–µ 110',
        '–¥–æ–ª–ª–∞—Ä —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è', '–¥–æ–ª–ª–∞—Ä –ø—Ä–æ–±–∏–ª —É—Ä–æ–≤–µ–Ω—å', '–¥–æ–ª–ª–∞—Ä –∫ —Ä—É–±–ª—é',
        'usd/rub', '–¥–æ–ª–ª–∞—Ä –≤—ã—à–µ', '–¥–æ–ª–ª–∞—Ä —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –º–∞–∫—Å–∏–º—É–º',
        '–ø–∞—Ä–∞ –¥–æ–ª–ª–∞—Ä/—Ä—É–±–ª—å', '–±–∏–≤–∞–ª—é—Ç–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞',

        // –ú–æ–Ω–µ—Ç–∞—Ä–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –°–®–ê/–º–∏—Ä–∞ (—É–∂–µ—Å—Ç–æ—á–µ–Ω–∏–µ)
        '—Ñ—Ä—Å', 'federal reserve', '–ø–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ —Ñ—Ä—Å', '—Ç–∞pering',
        '—É–∂–µ—Å—Ç–æ—á–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏', '—è—Å—Ç—Ä–µ–±–∏–Ω—ã–π', '–∏–Ω—Ñ–ª—è—Ü–∏—è –≤ —Å—à–∞',
        '–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ —Å—à–∞', '–¥–∂–µ—Ä–æ–º –ø–∞—É—ç–ª–ª', 'fomc',
        '–ø—Ä–æ—Ç–æ–∫–æ–ª —Ñ—Ä—Å', '–º–∏–Ω—É—Ç–∫–∏ —Ñ—Ä—Å', '–ø–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏',
        '—É–∂–µ—Å—Ç–æ—á–µ–Ω–∏–µ –¥–∫–ø', '—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Ñ—Ä—Å', 'qt',

        // –ü—Ä–æ—á–∏–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
        '–≤–æ–π–Ω–∞', '–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è', '—Ç—Ä–µ–≤–æ–≥–∞', '–æ–ø–∞—Å–µ–Ω–∏—è', '–ø–µ—Å—Å–∏–º–∏–∑–º',
        '—à–æ–∫', '–ø—Ä–æ–≤–∞–ª', '–∫—Ä–∞—Ö', '–±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ', '–¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è',
        '—Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä', '—á—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ', '—ç–ø–∏–¥–µ–º–∏—è', '–ø–∞–Ω–¥–µ–º–∏—è',
        '–∫–∞—Ä–∞–Ω—Ç–∏–Ω', '–ª–æ–∫–¥–∞—É–Ω', '–º–∞—Å—Å–æ–≤—ã–µ –±–µ—Å–ø–æ—Ä—è–¥–∫–∏', '–ø—Ä–æ—Ç–µ—Å—Ç—ã',
        '–º–∏—Ç–∏–Ω–≥–∏', '–∑–∞–±–∞—Å—Ç–æ–≤–∫–∏', '–∞–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∞', '–Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ',
        '–æ—Ç—Å—Ç–∞–≤–∫–∞', '–∏–º–ø–∏—á–º–µ–Ω—Ç', '–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å', '—Ä–æ—Å–ø—É—Å–∫',
        '–¥–æ—Å—Ä–æ—á–Ω—ã–µ –≤—ã–±–æ—Ä—ã', '–≥–æ—Å–ø–µ—Ä–µ–≤–æ—Ä–æ—Ç', '–º—è—Ç–µ–∂', '–±—É–Ω—Ç',

        // –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–π–¥–µ—Ä—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã (—É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø–∞–Ω–∏–∫—É/—Ä–∏—Å–∫)
        '–ª–æ–Ω–≥', '—à–æ—Ä—Ç', '—Ñ–∏–∫—Å–∏–Ω–≥', '–±–∏—Ä–∂–µ–≤—ã–µ —Ç–æ—Ä–≥–∏', '–æ–±—ä—ë–º —Ç–æ—Ä–≥–æ–≤',
        '–ª–∏–∫–≤–∏–¥–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π', '–º–∞—Ä–∂–∏–Ω-–∫–æ–ª–ª', '—Å—Ç–æ–ø-–ª–æ—Å—Å', '–ø—Ä–æ—Å–∞–¥–∫–∞',
        '–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å', '—Ö–∞–π–ø', '–ø–∞–Ω–∏–∫–∞', '—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞', '–¥–∞–º–ø',
        '–º–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥', '–Ω–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥', '–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å',
        '—É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏', '—É—Ä–æ–≤–µ–Ω—å —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è', '–ø—Ä–æ–±–æ–π',
        '–ª–æ–∂–Ω—ã–π –ø—Ä–æ–±–æ–π', '—Ä–µ—Ç–µ—Å—Ç', '–∫–æ—Ä—Ä–µ–∫—Ü–∏—è', '–æ—Ç—Å–∫–æ–∫',

        // –ö–ª—é—á–µ–≤—ã–µ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ —Å–æ–±—ã—Ç–∏—è (–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ)
        '–ø—É—Ç–∏–Ω', '–ª–∞–≤–∞', '–º–µ–¥–≤–µ–¥–µ–≤', '–ø–µ—Å–∫–æ–≤', '–º–∏—à—É—Å—Ç–∏–Ω', '—Å–∏–ª—É–∞–Ω–æ–≤',
        '–Ω–∞–±–∏—É–ª–ª–∏–Ω–∞', '—Ç—Ä–∞–º–ø', '–±–∞–π–¥–µ–Ω', '–º–∞–∫—Ä–æ–Ω', '—à–æ–ª—å—Ü', '—Å—É–Ω–∞–∫',
        '—Ç—Ä–∏—Å—Å', '–±–ª–∞—Ç—Ç–µ—Ä', '–º–∏–Ω—Ñ–∏–Ω', '–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Ä—Ñ', '–∫—Ä–µ–º–ª—å',
        '–≥–æ—Å–¥—É–º–∞', '—Å–æ–≤–µ—Ç —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏', '–º–∏–¥ —Ä—Ñ', '–ª–∞–≤—Ä–æ–≤',

        // –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã –∏ –≤–∞–ª—é—Ç—ã (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —É –Ω–∏—Ö)
        '–µ–≤—Ä–æ–ø–∞', '–µ–≤—Ä–æ—Å–æ—é–∑', '–µ –≤—Ä–æ–∑–æ–Ω–∞', '–∫–∏—Ç–∞–π', '—é–∞–Ω—å', '–µ–≤—Ä–æ',
        '—Ñ—É–Ω—Ç', '–∏–µ–Ω–∞', '–ª–∏—Ä–∞', '—Ä–µ–∞–ª', '—Ä—É–ø–∏—è', '–≤–æ–Ω–∞',
        '–¥–æ–ª–≥–æ–≤–æ–π –∫—Ä–∏–∑–∏—Å', '–¥–µ—Ñ–æ–ª—Ç –≥—Ä–µ—Ü–∏–∏', 'brexit', '—Ç–æ—Ä–≥–æ–≤—ã–µ –≤–æ–π–Ω—ã',
        '–ø–æ—à–ª–∏–Ω—ã —Ç—Ä–∞–º–ø–∞', '—Ç–æ—Ä–≥–æ–≤—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å—à–∞-–∫–∏—Ç–∞–π',

        // –ü—Ä–∏—Ä–æ–¥–Ω—ã–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã –∏ —Ç–µ—Ö–Ω–æ–≥–µ–Ω–Ω—ã–µ –∞–≤–∞—Ä–∏–∏
        '–∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ', '–Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ', '—Ü—É–Ω–∞–º–∏', '—É—Ä–∞–≥–∞–Ω', '—Ç–∞–π—Ñ—É–Ω',
        '–∑–∞—Å—É—Ö–∞', '–ø–æ–∂–∞—Ä', '–ª–µ—Å–Ω—ã–µ –ø–æ–∂–∞—Ä—ã', '–∞–≤–∞—Ä–∏—è', '–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞',
        '–∫—Ä—É—à–µ–Ω–∏–µ', '–≤–∑—Ä—ã–≤', '—Ä–∞–∑–ª–∏–≤ –Ω–µ—Ñ—Ç–∏', '—ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞',

        // –ö–∏–±–µ—Ä–∞—Ç–∞–∫–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
        '–∫–∏–±–µ—Ä–∞—Ç–∞–∫–∞', '—Ö–∞–∫–µ—Ä—ã', '–≤–∑–ª–æ–º', '—É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö', '–≤–∏—Ä—É—Å',
        'ransomware', 'ddos', '–∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞',
    ],

    // üìâ –ú–µ–¥–≤–µ–∂—å–∏ –¥–ª—è Si (—Ä—É–±–ª—å —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è ‚Üí Si –ø–∞–¥–∞–µ—Ç)
    bearish: [
        // –†–æ—Å—Ç —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å –∏ —Å—ã—Ä—å—ë
        '–Ω–µ—Ñ—Ç—å —Ä–∞—Å—Ç—ë—Ç', '–Ω–µ—Ñ—Ç—å –¥–æ—Ä–æ–∂–∞–µ—Ç', '—Ä–æ—Å—Ç —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å', 'brent —Ä–∞—Å—Ç—ë—Ç',
        '–Ω–µ—Ñ—Ç—å –≤–≤–µ—Ä—Ö', '–Ω–µ—Ñ—Ç—å –ø–æ–¥–æ—Ä–æ–∂–∞–ª–∞', '—Å—ã—Ä—å—ë –¥–æ—Ä–æ–∂–∞–µ—Ç', '–≥–∞–∑ –¥–æ—Ä–æ–∂–∞–µ—Ç',
        '–Ω–µ—Ñ—Ç—å –ø—Ä–æ–±–∏–ª–∞ —É—Ä–æ–≤–µ–Ω—å', '–Ω–µ—Ñ—Ç—å –¥–æ—Å—Ç–∏–≥–ª–∞ –º–∞–∫—Å–∏–º—É–º–∞', '–Ω–µ—Ñ—Ç—å –≤—ã—à–µ',
        '–æ–ø–µ–∫+ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –¥–æ–±—ã—á—É', '–æ–ø–µ–∫+ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç —Å–¥–µ–ª–∫—É', '–¥–µ—Ñ–∏—Ü–∏—Ç –Ω–µ—Ñ—Ç–∏',
        '–∑–∞–ø–∞—Å—ã –Ω–µ—Ñ—Ç–∏ –ø–∞–¥–∞—é—Ç', '–Ω–µ—Ñ—Ç—å –≤ –¥–µ—Ñ–∏—Ü–∏—Ç–µ', '—Å–∞–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ –∏—Ä–∞–Ω–∞',
        '—Å–∞–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ –≤–µ–Ω–µ—Å—É—ç–ª—ã', '–ø–µ—Ä–µ–±–æ–∏ –ø–æ—Å—Ç–∞–≤–æ–∫', '–∞–≤–∞—Ä–∏—è –Ω–∞ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–∏',

        // –ú–∞–∫—Ä–æ—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —É—Å–ø–µ—Ö–∏ –†–æ—Å—Å–∏–∏
        '—Ä–æ—Å—Ç –≤–≤–ø', '–ø—Ä–æ—Ñ–∏—Ü–∏—Ç', '—ç–∫—Å–ø–æ—Ä—Ç', '–∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏–µ',
        '–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å', '–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', '—É—Ä–æ–∂–∞–π', '—Ä–µ–∫–æ—Ä–¥',
        '–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', '–ø–æ–¥—ä—ë–º', '—Ä–æ—Å—Ç', '—É–ª—É—á—à–µ–Ω–∏–µ', '–ø–æ–∑–∏—Ç–∏–≤',
        '–æ–ø—Ç–∏–º–∏–∑–º', '–¥–∏–Ω–∞–º–∏–∫–∞', '—Ä–∞–∑–≤–∏—Ç–∏–µ', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–ª–∏–º–∞—Ç',
        '–¥–µ–ª–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', '–∏–Ω–¥–µ–∫—Å PMI', '–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π —Å–µ–∫—Ç–æ—Ä',
        '—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ', '—Ç–æ—Ä–≥–æ–≤–ª—è', '—Ä–æ–∑–Ω–∏—Ü–∞', '—Å–ø—Ä–æ—Å', '–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ',
        '—Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ—Ö–æ–¥—ã', '–∑–∞—Ä–ø–ª–∞—Ç—ã', '–ø–µ–Ω—Å–∏–∏', '—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã',

        // –ë—é–¥–∂–µ—Ç –∏ –Ω–∞–ª–æ–≥–∏ (–ø—Ä–æ—Ñ–∏—Ü–∏—Ç, –≤—ã—Å–æ–∫–∏–µ –¥–æ—Ö–æ–¥—ã)
        '–±—é–¥–∂–µ—Ç', '–¥–æ—Ö–æ–¥—ã', '–Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤—ã–µ –¥–æ—Ö–æ–¥—ã', '–Ω–∞–ª–æ–≥–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥',
        '–Ω–∞–ª–æ–≥–∏', '–º–∏–Ω—Ñ–∏–Ω', '–∫–∞–∑–Ω–∞—á–µ–π—Å—Ç–≤–æ', '—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç',
        '—Å–±–æ—Ä—ã', '–ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è', '–ø—Ä–æ—Ñ–∏—Ü–∏—Ç –±—é–¥–∂–µ—Ç–∞', '—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ–æ–Ω–¥',
        '—Ñ–Ω–±', '–Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è', '—Å–≤–µ—Ä—Ö–¥–æ—Ö–æ–¥—ã', 'windfall tax',

        // –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ä—É–±–ª—è
        '—Ä—É–±–ª—å —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è', '—Ä—É–±–ª—å —Ä–∞—Å—Ç—ë—Ç', '–¥–æ–ª–ª–∞—Ä –ø–∞–¥–∞–µ—Ç',
        '—Ä—É–±–ª—å –¥–æ—Ä–æ–∂–∞–µ—Ç', '–Ω–∞—Ü–≤–∞–ª—é—Ç–∞', '–∫—É—Ä—Å —Ä—É–±–ª—è', '—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ',
        '—Ä—É–±–ª—å –≤—ã—à–µ', '—Ä—É–±–ª—å –ø—Ä–æ–±–∏–ª —É—Ä–æ–≤–µ–Ω—å', '–¥–æ–ª–ª–∞—Ä –Ω–∏–∂–µ',
        '–ø–∞—Ä–∞ usd/rub —Å–Ω–∏–∂–∞–µ—Ç—Å—è', '—Ä—É–±–ª—å —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –º–∏–Ω–∏–º—É–º',

        // –î–µ–π—Å—Ç–≤–∏—è –¶–ë –†–§ (–ø–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏, –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏)
        '—Ü–±', '—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–∞–Ω–∫', '–∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞', '–ø–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏',
        '—Å—Ç–∞–≤–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∞', '–∂–µ—Å—Ç–∫–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞', '–∫—Ä–µ–¥–∏—Ç—ã –¥–æ—Ä–æ–∂–∞—é—Ç',
        '—ç–ª—å–≤–∏—Ä–∞ –Ω–∞–±–∏—É–ª–ª–∏–Ω–∞', '—Å–æ–≤–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤ —Ü–±', '–∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏',
        '–≤–∞–ª—é—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏', '–ø—Ä–æ–¥–∞–∂–∞ –≤–∞–ª—é—Ç—ã', '–≤–∞–ª—é—Ç–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä',
        '—Ç–∞—Ä–≥–µ—Ç –ø–æ –∏–Ω—Ñ–ª—è—Ü–∏–∏', '–¥–∫–ø', '–¥–µ–Ω–µ–∂–Ω–æ-–∫—Ä–µ–¥–∏—Ç–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞',

        // –ü—Ä–∏—Ç–æ–∫ –∫–∞–ø–∏—Ç–∞–ª–∞ –∏ —Ä–µ–∑–µ—Ä–≤—ã
        '–ø—Ä–∏—Ç–æ–∫ –∫–∞–ø–∏—Ç–∞–ª–∞', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '—Ä–µ–∑–µ—Ä–≤—ã', '–∑–æ–ª–æ—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–µ',
        '–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª', '–≤–ª–æ–∂–µ–Ω–∏—è', '—Ñ–æ–Ω–¥—ã', '–ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–µ',
        '–ø—Ä—è–º—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '—Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª', 'hot money',
        '–æ—Ñ—à–æ—Ä—ã', '–¥–µ–æ—Ñ—à–æ—Ä–∏–∑–∞—Ü–∏—è', '–∞–º–Ω–∏—Å—Ç–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞',

        // –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–¥–∏–ø–ª–æ–º–∞—Ç–∏—è, —Å–æ–≥–ª–∞—à–µ–Ω–∏—è)
        '–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', '–¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏', '—Å–¥–µ–ª–∫–∞', '—Å–æ–≥–ª–∞—à–µ–Ω–∏–µ',
        '–ø–æ–º–æ—â—å', '–ø–æ–¥–¥–µ—Ä–∂–∫–∞', '–∫—Ä–µ–¥–∏—Ç', '—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
        '—Å–∞–º–º–∏—Ç', '–≤—Å—Ç—Ä–µ—á–∞ –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ', '–≤–∏–∑–∏—Ç', '–¥–µ–ª–µ–≥–∞—Ü–∏—è',
        '–ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ', '—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ', '–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è', '—Å–æ—é–∑',

        // –°–Ω–∏–∂–µ–Ω–∏–µ –≥–µ–æ–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω–æ—Å—Ç–∏
        '–¥–µ—ç—Å–∫–∞–ª–∞—Ü–∏—è', '–ø–µ—Ä–µ–º–∏—Ä–∏–µ', '–ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –æ–≥–Ω—è', '–º–∏—Ä–Ω—ã–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã',
        '—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è', '—É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ', '–∫–æ–Ω—Å–µ–Ω—Å—É—Å', '–æ—Ç–≤–æ–¥ –≤–æ–π—Å–∫',
        '–æ–±–º–µ–Ω –ø–ª–µ–Ω–Ω—ã–º–∏', '–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä', '–ø–µ—Ä–µ–º–∏—Ä–∏–µ',

        // –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (—Å–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
        '–∏–Ω–¥–µ–∫—Å –¥–µ–ª–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏', 'pmi', '–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π —Å–µ–∫—Ç–æ—Ä',
        '—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ', '—Ç–æ—Ä–≥–æ–≤–ª—è', '—Ä–æ–∑–Ω–∏—Ü–∞', '—Å–ø—Ä–æ—Å', '–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ',
        '–±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞ —Å–Ω–∏–∂–∞–µ—Ç—Å—è', '–∑–∞–Ω—è—Ç–æ—Å—Ç—å', '—á–∏—Å–ª–æ —Ä–∞–±–æ—á–∏—Ö –º–µ—Å—Ç',
        '–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', '–∑–∞–∫–∞–∑—ã', '–æ—Ç–≥—Ä—É–∑–∫–∏',

        // –ö–ª—é—á–µ–≤—ã–µ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ —Å–æ–±—ã—Ç–∏—è (–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ)
        '–ø—É—Ç–∏–Ω', '–ª–∞–≤–∞', '–º–µ–¥–≤–µ–¥–µ–≤', '–ø–µ—Å–∫–æ–≤', '–º–∏—à—É—Å—Ç–∏–Ω', '—Å–∏–ª—É–∞–Ω–æ–≤',
        '–Ω–∞–±–∏—É–ª–ª–∏–Ω–∞', '—Ç—Ä–∞–º–ø', '–±–∞–π–¥–µ–Ω', '–º–∞–∫—Ä–æ–Ω', '—à–æ–ª—å—Ü', '—Å—É–Ω–∞–∫',
        '—Ç—Ä–∏—Å—Å', '–±–ª–∞—Ç—Ç–µ—Ä', '–º–∏–Ω—Ñ–∏–Ω', '–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Ä—Ñ', '–∫—Ä–µ–º–ª—å',
        '–≥–æ—Å–¥—É–º–∞', '—Å–æ–≤–µ—Ç —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏', '–º–∏–¥ —Ä—Ñ', '–ª–∞–≤—Ä–æ–≤',

        // –°—ã—Ä—å–µ–≤—ã–µ —Ä—ã–Ω–∫–∏ (—Ä–æ—Å—Ç —Ü–µ–Ω –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã)
        '–º–µ—Ç–∞–ª–ª—ã –¥–æ—Ä–æ–∂–∞—é—Ç', '–∑–æ–ª–æ—Ç–æ —Ä–∞—Å—Ç—ë—Ç', '—Å–µ—Ä–µ–±—Ä–æ —Ä–∞—Å—Ç—ë—Ç', '–ø–ª–∞—Ç–∏–Ω–∞',
        '–ø–∞–ª–ª–∞–¥–∏–π', '–Ω–∏–∫–µ–ª—å', '–º–µ–¥—å', '–∞–ª—é–º–∏–Ω–∏–π', '—Å—Ç–∞–ª—å', '—Ä—É–¥–∞',
        '—É–¥–æ–±—Ä–µ–Ω–∏—è', '–ø—à–µ–Ω–∏—Ü–∞', '–∑–µ—Ä–Ω–æ', '–ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–æ–µ –º–∞—Å–ª–æ',

        // –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É—Å–ø–µ—Ö–∏
        '–∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏–µ', '–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—É–≤–µ—Ä–µ–Ω–∏—Ç–µ—Ç',
        '—Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è', '–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏', '—Å—Ç–∞—Ä—Ç–∞–ø—ã', '–≤–µ–Ω—á—É—Ä', '–Ω–∞–Ω–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',
        '–∫–æ—Å–º–æ—Å', '–∞–≤–∏–∞–ø—Ä–æ–º', '–∞–≤—Ç–æ–ø—Ä–æ–º', '–æ–±–æ—Ä–æ–Ω–ø—Ä–æ–º',

        // –ü—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ)
        '—É—Ä–æ–∂–∞–π', '—Ä–µ–∫–æ—Ä–¥–Ω—ã–π —É—Ä–æ–∂–∞–π', '–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–∞—è –ø–æ–≥–æ–¥–∞', '—Å–µ–≤',
        '—É–±–æ—Ä–∫–∞', '—ç–∫—Å–ø–æ—Ä—Ç –∑–µ—Ä–Ω–∞', '–ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
    ]
};

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ—Å—Ç–∏
        function getNewsImpact(title, description) {
            const text = (title + ' ' + (description || '')).toLowerCase();
            const highImpact = ['—Å–∞–Ω–∫—Ü–∏–∏', '–∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞', '—Ü–± —Ä—Ñ', '—Ñ—Ä—Å', 'federal reserve', '–Ω–µ—Ñ—Ç—å', 'brent', '–∏–Ω—Ñ–ª—è—Ü–∏—è'];
            const mediumImpact = ['—Ä—É–±–ª—å', '–¥–æ–ª–ª–∞—Ä', '—ç–∫–æ–Ω–æ–º–∏–∫–∞', '–±–∏—Ä–∂–∞', '–º–º–≤–±', '—Ä—ã–Ω–æ–∫'];

            for (const word of highImpact) {
                if (text.includes(word)) return 'high';
            }
            for (const word of mediumImpact) {
                if (text.includes(word)) return 'medium';
            }
            return 'low';
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏
        function getNewsSentiment(title, description) {
            const text = ((title || '') + ' ' + (description || '')).toLowerCase();

            let bullishScore = 0;
            let bearishScore = 0;

            for (const keyword of KEYWORDS.bullish) {
                if (text.includes(keyword)) bullishScore += 1;
            }
            for (const keyword of KEYWORDS.bearish) {
                if (text.includes(keyword)) bearishScore += 1;
            }

            if (bullishScore > bearishScore) return 'bullish';
            if (bearishScore > bullishScore) return 'bearish';
            return 'neutral';
        }

        async function fetchNews() {
            const container = document.getElementById('newsList');
            container.innerHTML = '<div style="text-align: center; color: #8b949e; padding: 20px;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>';

            const allFetchedNews = [];

            for (const rssUrl of RSS_FEEDS) {
                try {
                    const news = await fetchFromRSS(rssUrl);
                    allFetchedNews.push(...news);
                } catch (e) {
                    console.log(`Failed to fetch ${rssUrl}:`, e);
                }
            }

            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
            if (allFetchedNews.length === 0) {
                console.log('Using fallback news');
                const news = generateFallbackNews();
                allNews = news;
                analysisState.news.items = news;
                renderNews(news);
                updateNewsInfluence(news);
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å–≤–µ–∂–∏–µ first)
            allFetchedNews.sort((a, b) => b.time - a.time);

            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 48 —á–∞—Å–æ–≤
            const now = new Date();
            const filteredNews = allFetchedNews.filter(n => {
                const hoursDiff = (now - n.time) / (1000 * 60 * 60);
                return hoursDiff <= 48;
            });

            allNews = filteredNews;
            analysisState.news.items = filteredNews;
            renderNews(filteredNews);
            updateNewsInfluence(filteredNews);
        }

        async function fetchFromRSS(rssUrl) {
            const news = [];
            const encodedUrl = encodeURIComponent(rssUrl);
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodedUrl}`;

            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Network response was not ok');

            const data = await response.json();

            if (data.status !== 'ok' || !data.items) {
                throw new Error('Invalid RSS data');
            }

            for (const item of data.items) {
                const pubDate = new Date(item.pubDate);
                const title = item.title || '';
                const description = item.description || '';

                const impact = getNewsImpact(title, description);
                const sentiment = getNewsSentiment(title, description);

                news.push({
                    id: Math.random().toString(36).substr(2, 9),
                    time: pubDate,
                    title: title.substring(0, 150),
                    text: description.replace(/<[^>]*>/g, '').substring(0, 200),
                    impact: impact,
                    sentiment: sentiment,
                    link: item.link
                });
            }

            return news;
        }

        function generateFallbackNews() {
            const now = new Date();
            const templates = [
                { title: '–¶–ë –†–§: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏', sentiment: 'neutral', impact: 'high' },
                { title: '–ö—É—Ä—Å –¥–æ–ª–ª–∞—Ä–∞ –Ω–∞ –ú–ú–í–ë', sentiment: 'neutral', impact: 'medium' },
                { title: '–¶–µ–Ω—ã –Ω–∞ –Ω–µ—Ñ—Ç—å Brent', sentiment: 'bearish', impact: 'high' }
            ];

            return templates.map((item, i) => ({
                id: i,
                time: new Date(now.getTime() - i * 3600000),
                title: item.title,
                text: '–î–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
                impact: item.impact,
                sentiment: item.sentiment
            }));
        }

        function renderNews(news) {
            const container = document.getElementById('newsList');
            document.getElementById('newsCount').textContent = news.length;

            if (news.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #8b949e; padding: 20px;">–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π</div>';
                return;
            }

            container.innerHTML = news.map(item => {
                const timeStr = item.time.toLocaleString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const sentimentLabel = {
                    'bullish': 'üìà –ë—ã—á—å—è –¥–ª—è Si',
                    'bearish': 'üìâ –ú–µ–¥–≤–µ–∂—å—è –¥–ª—è Si',
                    'neutral': '‚û°Ô∏è –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è'
                };

                return `
                    <div class="news-item ${item.impact}">
                        <div class="news-time">${timeStr}</div>
                        <div class="news-text"><strong>${item.title}</strong></div>
                        <div class="news-text" style="font-size: 12px; color: #8b949e; margin-top: 4px;">${item.text}</div>
                        <span class="news-sentiment sentiment-${item.sentiment}">${sentimentLabel[item.sentiment]}</span>
                    </div>
                `;
            }).join('');
        }

        function updateNewsInfluence(news) {
            let bullishScore = 0;
            let bearishScore = 0;

            const now = new Date();

            news.forEach(item => {
                const hoursDiff = (now - item.time) / (1000 * 60 * 60);
                const impactWeight = item.impact === 'high' ? 30 : item.impact === 'medium' ? 15 : 5;

                // –°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤–∞–∂–Ω–µ–µ
                const recencyMultiplier = Math.max(0.1, 1 - hoursDiff / 48);

                const score = impactWeight * recencyMultiplier;

                if (item.sentiment === 'bullish') {
                    bullishScore += score;
                } else if (item.sentiment === 'bearish') {
                    bearishScore += score;
                }
            });

            // –ò—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π = –±—ã—á–∏–π –¥–ª—è Si, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π = –º–µ–¥–≤–µ–∂–∏–π
            const netScore = bullishScore - bearishScore;
            analysisState.news.score = netScore;
            analysisState.news.direction = netScore > 10 ? 'bullish' : netScore < -10 ? 'bearish' : 'neutral';
            analysisState.news.items = news;
        }

        function filterNews(type, event) {
            currentNewsFilter = type;

            document.querySelectorAll('#newsBox .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }

            let filtered = allNews;

            if (type === 'bullish') {
                filtered = allNews.filter(n => n.sentiment === 'bullish');
            } else if (type === 'bearish') {
                filtered = allNews.filter(n => n.sentiment === 'bearish');
            }

            renderNews(filtered);
        }

        function refreshNews() {
            fetchNews();
        }

        // ==================== 4. –†–ï–ê–õ–¢–ê–ô–ú –ì–†–ê–§–ò–ö ==================
        function updateChartLive(price) {
            if (!candleSeries || !historyData.length) return;

            const nowUtc = Math.floor(Date.now() / 1000);
            const mskOffset = 3 * 3600; // –ú–æ—Å–∫–≤–∞ UTC+3
            const nowMsk = nowUtc + mskOffset;

            const tfSeconds = currentTf * 60;
            const startOfIntervalMsk = Math.floor(nowMsk / tfSeconds) * tfSeconds;
            const currentCandleTime = startOfIntervalMsk - mskOffset;

            let lastCandle = historyData[historyData.length - 1];

            if (lastCandle.time === currentCandleTime) {
                lastCandle.close = price;
                if (price > lastCandle.high) lastCandle.high = price;
                if (price < lastCandle.low) lastCandle.low = price;
            } else {
                historyData.push({ time: currentCandleTime, open: lastCandle.close, high: price, low: price, close: price });
                if (historyData.length > 500) historyData.shift();
            }
            candleSeries.update(historyData[historyData.length - 1]);
        }

        // ==================== 5. –û–¢–†–ò–°–û–í–ö–ê –ì–†–ê–§–ò–ö–ê ==================
function renderChart(data) {
    const cont = document.getElementById('chart');
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ loading, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    const loading = document.getElementById('loading');
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    cont.innerHTML = '';
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º loading (—Å–∫—Ä—ã—Ç—ã–º)
    if (loading) {
        cont.appendChild(loading);
        loading.style.display = 'none';
    } else {
        // –ï—Å–ª–∏ loading –ø–æ—á–µ–º—É-—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª, —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π
        const newLoading = document.createElement('div');
        newLoading.id = 'loading';
        newLoading.innerHTML = '<div class="spinner"></div> –ó–∞–≥—Ä—É–∑–∫–∞...';
        newLoading.style.display = 'none';
        cont.appendChild(newLoading);
    }
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫, –µ—Å–ª–∏ –±—ã–ª
    if (chart) {
        chart.remove();
        chart = null;
    }
    priceLines = [];

    chart = LightweightCharts.createChart(cont, {
        layout: { background: { color: '#161b22' }, textColor: '#8b949e' },
        grid: { vertLines: { color: '#222' }, horzLines: { color: '#222' } },
        timeScale: { timeVisible: true },
        width: cont.clientWidth, height: 400
    });
    candleSeries = chart.addCandlestickSeries({ upColor: '#238636', downColor: '#f85149', borderVisible: false });
    candleSeries.setData(data);
    chart.timeScale().fitContent();
}

        function drawPlan(e, tp, sl) {
            if(!candleSeries) return;
            priceLines.forEach(l => candleSeries.removePriceLine(l));
            priceLines = [];
            const mkLine = (p, c, t) => candleSeries.createPriceLine({ price: p, color: c, lineWidth: 2, lineStyle: 1, title: t });
            priceLines.push(mkLine(e, '#58a6ff', 'Entry'));
            priceLines.push(mkLine(tp, '#238636', 'TP'));
            priceLines.push(mkLine(sl, '#f85149', 'SL'));
        }

        // ==================== 6. UI ==================
        function updatePriceUI(q) {
            if(!q || !q.price) return;
            document.getElementById('currentPrice').innerText = q.price.toFixed(2);
            if(q.prev > 0) {
                const pct = ((q.price - q.prev)/q.prev * 100);
                document.getElementById('changePercent').innerText = (pct>=0?'+':'') + pct.toFixed(2)+'%';
                document.getElementById('changePercent').style.color = pct>=0?'var(--buy)':'var(--sell)';
            }
            if(q.time) document.getElementById('lastTradeTime').innerText = "–°–¥–µ–ª–∫–∞: " + new Date(q.time).toLocaleTimeString('ru-RU');
        }

        // ==================== 7. –ê–ù–ê–õ–ò–ó ==================
        function calcTech() {
            if (historyData.length < 20) return null;
            const c = historyData.map(d=>d.close);
            let g=0,l=0;
            for(let i=c.length-14;i<c.length;i++){ const d=c[i]-c[i-1]; if(d>0)g+=d; else l-=d; }
            const rsi = l===0 ? 100 : 100 - (100/(1+g/l));
            const ema = (p,per) => p.slice(1).reduce((e,v)=>v*(2/(per+1))+e*(1-2/(per+1)), p[0]);
            const macd = ema(c,12)-ema(c,26);
            let tr=0;
            for(let i=historyData.length-14;i<historyData.length;i++){ const h=historyData[i].high, l=historyData[i].low, pc=historyData[i-1].close; tr+=Math.max(h-l, Math.abs(h-pc), Math.abs(l-pc)); }
            const atr = tr/14;

            document.getElementById('statsGrid').style.display='grid';
            document.getElementById('statRsi').innerText=rsi.toFixed(1);
            document.getElementById('statAtr').innerText=atr.toFixed(2);
            document.getElementById('statMacd').innerText=macd.toFixed(2);
            document.getElementById('statMacd').style.color=macd>0?'var(--buy)':'var(--sell)';
            document.getElementById('statTrend').innerText=c[c.length-1]>ema(c,20)?'BULL':'BEAR';

            return {rsi, atr, macd, price:c[c.length-1], trend: c[c.length-1]>ema(c,20)?'BULL':'BEAR'};
        }

        async function runAnalysis() {
            const key = document.getElementById('api_key_input').value.trim();
            if(!key) { 
                console.log("–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç API –∫–ª—é—á–∞");
                return; 
            }
            
            const tech = calcTech();
            if (!tech) { 
                console.log("–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–ø—É—â–µ–Ω: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö");
                return; 
            }

            document.getElementById('signal_text').innerText = "–ê–ù–ê–õ–ò–ó...";
            document.getElementById('tradePlanBox').style.display = 'none';
            document.getElementById('ai_desc').style.display = 'none';

            let newsContext = "–ù–û–í–û–°–¢–ù–û–ô –§–û–ù:\n";
            if (allNews.length > 0) {
                allNews.forEach((n, i) => newsContext += `${i+1}. ${n.title} (${n.sentiment === 'bullish' ? '–±—ã—á—å—è' : n.sentiment === 'bearish' ? '–º–µ–¥–≤–µ–∂—å—è' : '–Ω–µ–π—Ç—Ä.'})\n`);
            } else {
                newsContext += "–ù–µ—Ç —Å–≤–µ–∂–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π.\n";
            }

            const prompt = `–¢—ã –ø—Ä–æ—Ñ–∏-—Ç—Ä–µ–π–¥–µ—Ä Si.
–¶–µ–Ω–∞: ${tech.price.toFixed(2)}
RSI: ${tech.rsi.toFixed(1)}
MACD: ${tech.macd.toFixed(2)}
ATR: ${tech.atr.toFixed(2)}

 ${newsContext}

–û–±—â–∏–π –Ω–æ–≤–æ—Å—Ç–Ω–æ–π —Å—á—ë—Ç (–±—ã—á–∏–π-–º–µ–¥–≤–µ–∂–∏–π): ${analysisState.news.score.toFixed(1)} (${analysisState.news.direction})

–î–∞–π —Å–∏–≥–Ω–∞–ª: –ü–û–ö–£–ü–ö–ê/–ü–†–û–î–ê–ñ–ê/–î–ï–†–ñ–ê–¢–¨.
–ü–ª–∞–Ω (ATR):
BUY: TP=Price+1.5*ATR, SL=Price-1*ATR.
SELL: TP=Price-1.5*ATR, SL=Price+1*ATR.
JSON: { "signal":"...", "confidence":80, "entry":0, "tp":0, "sl":0, "reason":"..." }`;

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "deepseek/deepseek-v3.2", messages: [{role:"user", content:prompt}] })
                });
                const data = await res.json();
                if(data.error) throw new Error(data.error.message);
                const json = parse(data.choices[0].message.content);
                updateUI(json, tech.price);
            } catch(e) {
                document.getElementById('signal_text').innerText = "–û–®–ò–ë–ö–ê";
                document.getElementById('ai_desc').innerText = e.message;
                document.getElementById('ai_desc').style.display = 'block';
            }
        }

        function parse(s) { try { return JSON.parse(s.match(/\{[\s\S]*\}/)[0]); } catch { return {signal:"–î–ï–†–ñ–ê–¢–¨", confidence:0, reason:"err", entry:0,tp:0,sl:0}; } }

        function updateUI(j, p) {
            const ui = document.getElementById('signal_ui');
            ui.className = "signal-display " + (j.signal==='–ü–û–ö–£–ü–ö–ê'?'buy':j.signal==='–ü–†–û–î–ê–ñ–ê'?'sell':'hold');
            document.getElementById('signal_text').innerText = j.signal;
            document.getElementById('signal_confidence').innerText = `–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${j.confidence}%`;
            document.getElementById('ai_desc').innerText = j.reason;
            document.getElementById('ai_desc').style.display = 'block';
            
            if(j.entry && j.tp && j.sl && !isNaN(j.entry)) {
                document.getElementById('tradePlanBox').style.display='block';
                document.getElementById('aiEntry').innerText=j.entry.toFixed(2);
                document.getElementById('aiTP').innerText=j.tp.toFixed(2);
                document.getElementById('aiSL').innerText=j.sl.toFixed(2);
                drawPlan(j.entry, j.tp, j.sl);
            }
        }

        // ==================== 8. –ü–õ–ê–ù–ò–†–û–í–©–ò–ö –û–ë–ù–û–í–õ–ï–ù–ò–ô ==================
        function scheduleNextCandleUpdate() {
            const now = new Date();
            const target = new Date(now);
            target.setMinutes(16, 0, 0); // –º–∏–Ω—É—Ç—ã = 16, —Å–µ–∫—É–Ω–¥—ã = 0
            if (target <= now) {
                target.setHours(target.getHours() + 1);
            }
            const delay = target - now;
            console.log(`Next candle update scheduled at ${target.toLocaleTimeString()} (in ${Math.round(delay/1000)} seconds)`);
            setTimeout(async () => {
                await fetchCandles();
                scheduleNextCandleUpdate();
            }, delay);
        }

        // ==================== 9. –ê–í–¢–û–ê–ù–ê–õ–ò–ó ==================
        let autoAnalysisInterval = null;
        function startAutoAnalysis() {
            if (autoAnalysisInterval) clearInterval(autoAnalysisInterval);
            autoAnalysisInterval = setInterval(() => {
                const key = document.getElementById('api_key_input').value.trim();
                if (key) {
                    console.log('Running auto analysis at', new Date().toLocaleTimeString());
                    runAnalysis();
                } else {
                    console.log('Auto analysis skipped: no API key');
                }
            }, 300000); // 5 –º–∏–Ω—É—Ç
        }

        // ==================== INIT ==================
        function saveKey() { localStorage.setItem('si_k', document.getElementById('api_key_input').value); alert("OK"); }

        window.onload = async () => {
            const k = localStorage.getItem('si_k');
            if(k) document.getElementById('api_key_input').value=k;

            await detectActiveContract();
            await Promise.all([fetchQuotes(), fetchCandles(), fetchNews()]);

            setInterval(fetchQuotes, 2000); 
            setInterval(fetchNews, 600000); // –Ω–æ–≤–æ—Å—Ç–∏ —Ä–∞–∑ –≤ 10 –º–∏–Ω

            scheduleNextCandleUpdate();
            startAutoAnalysis();
        };
    </script>
</body>
</html>
